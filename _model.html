<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --max-width: 1080px;
        }

        * {
            box-sizing: border-box;
            outline: none;
        }

        html,
        body {
            font-family: sans-serif;
            font-size: 16px;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            position: relative;
            background-color: steelblue;
        }

        .container {
            width: 100%;
            max-width: var(--max-width);
            margin: auto;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        header {
            background-color: rgb(0, 0, 0);
            width: 100%;
            position: fixed;
            top: 0;
            z-index: 10;
            /* Garante que fique acima de outros elementos */
        }

        header a {
            color: white;
            text-decoration: none;
        }

        header nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        header h1 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: normal;
            padding: 1rem;
            white-space: nowrap;
        }

        header ul {
            display: flex;
            list-style: none;
            align-items: center;
            padding: 0;
            margin: 0;
        }

        header ul li {
            padding: .75rem;
            cursor: pointer;
            /* Indica que é clicável */
        }

        header ul li:hover {
            background-color: rgb(68, 68, 68);
        }

        main {
            flex-grow: 1;
            background-color: white;
            padding: 3.5rem 1rem 1rem 1rem;
        }

        footer {
            background-color: black;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
        }

        footer a {
            font-size: 1.5rem;
            color: white;
            text-decoration: none;
            padding: .5rem;
        }

        footer a:hover {
            background-color: rgb(68, 68, 68);
        }

        footer div {
            text-align: center;
            font-size: .75rem;
        }

        /* Estilo para o avatar (imagem) */
        .user-avatar {
            width: 32px;
            height: 32px;
            object-fit: cover;
            /* Garante que a imagem preencha o círculo */
            border-radius: 50%;
            vertical-align: middle;
            /* Ajuda a alinhar a imagem */
        }
    </style>
    <title>SpringPad</title>
</head>

<body>
    <a id="top"></a>
    <header>
        <nav class="container">
            <h1><a href="/">Spring<i class="fa-regular fa-file-lines"></i>Pad</a></h1>
            <ul>
                <li><a href="/">Início</a></li>
                <li><a href="/new">Novo</a></li>
                <li><a href="/contacts">Contatos</a></li>
                <li><a href="/about">Sobre</a></li>
                <li class="user-in-out" id="userInOut">
                    <a href="#" id="userInOutLink">
                        <img src="user.png" alt="Logue-se" class="user-avatar" referrerpolicy="no-referrer">
                    </a>
                </li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <h2>Título</h2>
        <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Sed nulla ex maxime iste reprehenderit nesciunt ab
            deleniti placeat expedita fugiat. Blanditiis est ratione facilis consectetur rem voluptatum dignissimos sint
            maiores?</p>
    </main>

    <footer>
        <a href="/"><i class="fa-solid fa-house fa-fw"></i></a>
        <div>&copy; Copyright 2025 Joca da Silva</div>
        <a href="#top"><i class="fa-solid fa-circle-up fa-fw"></i></a>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/12.4.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.4.0/firebase-auth-compat.js"></script>
    <script>
        // 2. Configuração do Projeto Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDHQPWxYc2Xc2xXwW2dh6bg1Bup7vjYNrk",
            authDomain: "ngcrud-93a6f.firebaseapp.com",
            projectId: "ngcrud-93a6f",
            storageBucket: "ngcrud-93a6f.firebasestorage.app",
            messagingSenderId: "1043187476281",
            appId: "1:1043187476281:web:777f337c87a8d171d22ae8"
        };

        // Inicializa o Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = app.auth();

        // 3. Referências aos elementos HTML
        const userInOut = document.getElementById('userInOut');
        const userInOutLink = document.getElementById('userInOutLink');

        // 4. Função para Login com Google (Popup)
        const googleLogin = async () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                // Abre o popup do Google para login
                await auth.signInWithPopup(provider);
                console.log('Login com Google bem-sucedido!');
                // O estado de autenticação será atualizado pelo listener onAuthStateChanged
            } catch (error) {
                console.error("Erro no login com Google:", error);
                alert('Erro ao fazer login. Verifique o console para mais detalhes.');
            }
        };

        // 5. Função para Logout
        const googleLogout = async () => {
            try {
                await auth.signOut();
                console.log('Logout bem-sucedido!');
            } catch (error) {
                console.error("Erro no logout:", error);
                alert('Erro ao fazer logout. Verifique o console para mais detalhes.');
            }
        };

        // 6. Função de Manipulação de Clique (Login/Página de Perfil)
        const handleUserInOutClick = (event) => {
            // Evita que o <a> navegue imediatamente, pois vamos gerenciar isso no JS
            event.preventDefault();

            const user = auth.currentUser;

            if (user) {
                // Usuário LOGADO: Redireciona para a página de perfil
                window.location.href = '/profile.html';
            } else {
                // Usuário DESLOGADO: Inicia o processo de login
                googleLogin();
            }
        };

        // 7. Função para atualizar a interface
        const updateUI = (user) => {
            // Limpa o conteúdo atual do avatar usuário
            userInOutLink.innerHTML = '';

            if (user) {
                // Usuário LOGADO: Mostra o Avatar

                // Cria o elemento <img>
                const avatarImg = `<img src="${user.photoURL || 'placeholder.jpg'}" alt="${user.displayName || 'Avatar do Usuário'}" class="user-avatar" referrerpolicy="no-referrer">`

                // Adiciona o avatar ao avatar usuário
                userInOutLink.innerHTML = avatarImg;

                // Atualiza o link para a página de perfil
                userInOutLink.href = '/profile.html';

            } else {
                // Usuário DESLOGADO: Mostra o ícone padrão

                // Cria o elemento <i> (ícone)
                const icon = `<img src="user.png" alt="Logue-se" class="user-avatar" referrerpolicy="no-referrer">`;

                // Adiciona o ícone ao avatar usuário
                userInOutLink.innerHTML = icon;

                // Atualiza o link para o login (embora o JS trate o clique)
                userInOutLink.href = '/login';
            }
        };

        // 8. Listener para o estado de autenticação (IMPORTANTE!)
        // Este listener é executado sempre que o estado do usuário (logado/deslogado) muda.
        auth.onAuthStateChanged((user) => {
            updateUI(user);
        });

        // 9. Adiciona o Event Listener ao elemento `userInOut`
        userInOut.addEventListener('click', handleUserInOutClick);

        // **OPCIONAL:** Se você precisar de um botão de logout, adicione um item à lista 
        // e um listener semelhante a este:
        // Exemplo: document.getElementById('logoutBtn').addEventListener('click', googleLogout);

    </script>
</body>

</html>